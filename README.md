# SIP-Demo   ----- Basic LOgic How SIP Session Initiation Protocol Works -------
SIP - Session Initiation Protocol  --- End to end oriented signaling protocol
-Easy Outgoing and incoming calls without having to manage sessions, transport-level communication, or audio record or playback directly.

Applications:
*Video Confereing
*Instant Messaging


Android SIP API
1.SipAudioCall 
-Handles an Internet audio call over sip
2.SipErrorCode
Defines error codes returned during SIP actions
3.SipManager
Provides API for SPI tasks initiating SIP connnections and provides access to related SIP services
4.SipProfile
Defines SIP profile include SIP Account domain and server information
5.SipSession
Represents Sip session associated with Sip dialog or a standlone transcation not within dialog
------------------------------------------------------------------------
Func of SIP
- Allow establishment of user Location
 -  Mechanism for call management
- Provides Feature Negotiation (so that parties in call can agree to feature supported 
------------------------------------------------------
Components of SIP
1.UAC - User Agent Client 
Those end users who generate request and then send those request to server.These request are generated by client
applications runniong on their system
2.UAS  -User Agent Server
Those system which get request generated by UAC Then UAS process those request and then according to request generate response
--------------------------------------------
SIP Manager :
This class is the starting point for any SIP actions. You can acquire an instance of it with newInstance().

Has Many Functions for managing SIP tasks:
1.close(String localProfileUri)

Closes the specified profile to not make/receive calls

2.getCallId(Intent incomingCallIntent)

Gets the call ID from the specified incoming call broadcast intent

3.isOpened(String localProfileUri)

Checks if the specified profile is opened in the SIP service for making and/or receiving calls

4.isSipWifiOnly(Context context)

Returns true if SIP is only available on WIFI

5.isRegistered(String localProfileUri)

Checks if the SIP service has successfully registered the profile to the SIP provider (specified in the profile) for receiving calls

6.isVoipSupported(Context context)

Returns true if the system supports SIP-based VOIP API
7.takeAudioCall(Intent incomingCallIntent, SipAudioCall.Listener listener)

Creates a SipAudioCall to take an incoming call
8.unregister(SipProfile localProfile, SipRegistrationListener listener)

Manually unregisters the profile from the corresponding SIP provider for stop receiving further calls
##SIP runs over a wireless data connection

----------------------------------------
SIP Tasks:
some tasks may generate several SIP requests, but most tasks sinply send a SIP request and waits for a SIP response. 
The SipInitTask is used to init common properties used by all SIP tasks, SipRegisterTask is the task generating the actual SIP REGISTER calls. Finally SipCloseTask is used to release all resources used by the SIP tasks.


--------------------------
SIP Dialog:
A Dialog is a peer-to-peer relationship between two user agents.
-----------------------------





%%%%%%%
pURPOSE OF SIP:
Along RTP and SDP protocols.
RTP:Real Time Transfer Protocol  Carry Real Time Multimedia Data(Audio video Text)
It makes it possible to encode and split the data into packets and transport these packets over the internet.
SDP :Session Describing Protocol It is  used to encode media so all the participants will be able to decode it.
It is  used to describe and encode capabilities of session participants. 



*****. It is an end-to-end oriented signaling protocol which means, that all the logic is stored in end devices (except routing of SIP messages)
 State is also stored in end-devices only, there is no single point of failure and networks designed this way scale well. 
 The price that we have to pay for the distributiveness and scalability is higher message overhead, caused by the messages being sent end-to-end.
 
 
 Sip Uri 
 SIP entities are identified using SIP URI (Uniform Resource Identifier). A SIP URI has form of sip:username@domain, for instance, sip:joe@company.com. 
 As we can see, SIP URI consists of username part and domain name part delimited by @ (at) character. SIP URIs are similar to e-mail addresses, it is, for instance,
 possible to use the same URI for e-mail and SIP communication, such URIs are easy to remember.
 
 
 
 Sip Network Elements :
 Basic SIP elements are user agents, proxies, registrars, and redirect servers. 
 
 
 Proxy Server :
 Allows creation of infrastructure of network hosts called Proxy Servers.
 They perform routing of a session invitations according to invitee's current location, authentication, accounting and many other important functions.
 The most important task of a proxy server is to route session invitations "closer" to callee. The session invitation will usually traverse a set of proxies until it finds one which knows the actual location of the callee. Such a proxy will forward the session invitation directly to the callee and the callee will then accept or decline the session invitation.

There are two basic types of SIP proxy servers--stateless and stateful.

StateLess Proxy Server:
Messages are arranged into transcations but Stateless pROTOCOL DO not care of theses transcations.
Stateless proxies are simple, but faster than stateful proxy servers. 
They can be used as simple load balancers, message translators and routers.
One of drawbacks of stateless proxies is that they are unable to absorb retransmissions of messages and perform more advanced routing, 
for instance, forking or recursive traversal.

StateFul Proxy Server:
Upon reception of a request, stateful proxies create a state and keep the state until the transaction finishes
Some transactions, especially those created by INVITE, can last quite long (until callee picks up or declines the call). 
Because stateful proxies must maintain the state for the duration of the transactions, their performance is limited.
The ability TO associate SIP messages into transactions provide additional featues :
1.Stateful proxies can perform forking, that means upon reception of a message two or more messages will be sent out.
2.Stateful proxies can absorb retransmissions because they know, from the transaction state, 
 if they have already received the same message whereas stateless proxies cannot do the check because they keep no state.
3.Can find Complicated User Location
Stateful proxies can perform more complicated methods of finding a user.
 It is, for instance, possible to try to reach user's office phone and when he doesn't pick up then the call is redirected to his cell phone. 
Stateless proxies can't do this because they have no way of knowing how the transaction targeted to the office phone finished
--------------------------------------------------
Proxy Server Usuage:
----------------------------------

Registrars :
The registrar is a special SIP entity that receives registrations from users, 
extracts information about their current location (IP address, port and username in this case) and stores the information into location database.
. Purpose of the location database is to map sip:bob@b.com to something like sip:bob@1.2.3.4:5060
A REGISTER message containing Address of Record sip:jan@iptel.org and contact address sip:jan@1.2.3.4:5060 where 1.2.3.4 is IP address of the phone, is sent to the registrar. 
The registrar extracts this information and stores it into the location database.
If everything went well then the registrar sends a 200 OK response to the phone and the process of registration is finished.

Redirect Server :
The entity that receives a request and sends back a reply containing a list of the current location of a particular user is called redirect server.
A redirect server receives requests and looks up the intended recipient of the request in the location database created by a registrar. 
It then creates a list of current locations of the user and sends it to the request originator in a response within 3xx class.


SIP Messages :
Communication using SIP (often called signaling) comprises of series of messages.
Messages are transported independently by the network.
Each message consist of "first line", message header, and message body. The first line identifies type of the message. 
There are two types of messages--requests and responses. Requests are usually used to initiate some action or inform recipient of the request of something. 
Replies are used to confirm that a request was received and processed and contain the status of the processing.


To and From Headers identify initiator (caller) and recipient (callee) of the invitation
Tag parameter  serves as Dialog Identifier


SIP request can contain more header fields used to record path of request.

SIP Headers :
A header is a component of a SIP message that conveys information about the message.
Header fields are defined as Header: field, where Header is used to represent the header field name, 
and field is the set of tokens that contains the information.
field-name:field-value
Headers :
To T
Via V
Call-ID I
Contact M
From F
Subject S
Content-Length I



Request Response Header Fields
Accept :
  used to indicate acceptable message Internet media types in
the message body.
* If not present, the assumed acceptable message body format is
application/sdp.
*A list of media types can have preferences set using q value parameters
The use of q value parameters can set preferences. If none of the listed schemes
are acceptable to the UAC, a 406 Not Acceptable response is returned. If not
included, the assumed encoding will be text/plain.


----------------------------------------------------------------------------------------------------------------------------------------------------------
Headers:
To :
To indicates the final recipient of the request. Any response generated by a UA will
contain this header field with the addition of a tag. It is a mandatory header.
* Any response generated by a proxy must have a tag added to the To header
field.
* The To header field URI is never used for routing.

From:
From header field indicates the originator of the request. It is one of two addresses used
to identify a dialog.
A From header field may contain a tag used to identify a particular call.
* It may contain a display name, in which case the URI is enclosed in <>.
* It is a mandatory header.

Call-ID :
The Call-ID header field is mandatory in all SIP requests and responses. It is used to
uniquely identify a call between two user agents.
A Call-ID must be unique across calls.
* All registrations for a user agent should use the same Call-ID.
* A Call-ID is always created by a user agent and is never modified by a server.
* It is a cryptographically random identifier.

Via :
Via is used to record the SIP route taken by a request which helps to route a response
back to the originator.
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

SIP API Calls:
Internet based Calls using SIP API
1.Make a call
2.Receive a call.
3.Signal to the Android platform that your app wants to receive incoming SIP calls


Application  Includes:
1.SIP Settings :  a PreferenceActivity that supplies basic settings for SIP authentication.
2.IncomingCallReceiver : a BroadcastReceiver that listens for incoming SIP calls and passes them to WalkieTalkieActivity for handling.
3.WalkieTalkieActivity :  a activity that login to SIP provider and registers the device to receive incoming SIP, handles incoming calls and makes outgoing calls, managing UI during the call.

Supported by Andrid 2.3 (API Level 9)
<uses-sdk android:minSdkVersion="9" />, which indicates to Android Market and the platform that your application requires Android 2.3 or higher.
<uses-feature android:name="android.hardware.sip.voip" />, which tells Android Market that your application uses the SIP API.
 The declaration should include an android:required attribute that indicates whether you want Android Market to filter the application from devices
 that do not offer SIP support. 
Other <uses-feature> declarations may also be needed, depending on your implementation.

SPI API : android.net.sip
 Intent Filter which type of Intents the component is likely to receive
 registerReceiver is method of BroadCast Receiver


SIP is a VoIP Protocol
 
 
MIS is extension of SIP
OpenMIS - Open Internet Protocol Multimedia Subsystem

 


